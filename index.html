<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ç”²åˆé©¬å¹´æ–°æ˜¥ç››å…¸ - æŠ½å¥–ã€ç¥ç¦ã€è´ºå¡ç”Ÿæˆ">
    <meta name="theme-color" content="#c41e3a">
    <title>ç”²åˆé©¬å¹´ Â· æ–°æ˜¥ç››å…¸</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;700&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --china-red: #c41e3a;
            --deep-red: #8b0000;
            --bright-red: #e74c3c;
            --gold: #ffd700;
            --dark-gold: #b8860b;
            --light-gold: #fff4d6;
            --cream: #fffef5;
            --dark-bg: #1a0a0a;
            --card-bg: #2d1515;
            
            --wheel-size: 350px;
            --wheel-inner-size: 100px;
            --animation-duration: 4s;
            --spark-interval: 300;
            --firework-count: 30;
        }
        
        @media (max-width: 768px) {
            :root {
                --wheel-size: 280px;
                --wheel-inner-size: 80px;
            }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Serif SC', serif;
            background: var(--dark-bg);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--cream);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-horse {
            font-size: 4rem;
            animation: horseGallop 0.8s ease-in-out infinite;
        }
        
        .loading-text {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.5rem;
            color: var(--gold);
            margin-top: 20px;
            letter-spacing: 0.3em;
        }
        
        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 215, 0, 0.2);
            border-radius: 2px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .loading-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--light-gold));
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .bg-gradient {
            background: 
                radial-gradient(ellipse at 50% 0%, rgba(196, 30, 58, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 0% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 40%),
                radial-gradient(ellipse at 100% 50%, rgba(255, 215, 0, 0.1) 0%, transparent 40%),
                radial-gradient(ellipse at 50% 100%, rgba(139, 0, 0, 0.4) 0%, transparent 50%);
        }
        
        .lanterns {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .lantern {
            position: absolute;
            font-size: 3rem;
            animation: swing 4s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5));
        }
        
        .lantern:nth-child(1) { left: 5%; top: 5%; animation-delay: 0s; }
        .lantern:nth-child(2) { left: 15%; top: 3%; animation-delay: 0.5s; font-size: 2.5rem; }
        .lantern:nth-child(3) { right: 5%; top: 5%; animation-delay: 1s; }
        .lantern:nth-child(4) { right: 15%; top: 3%; animation-delay: 1.5s; font-size: 2.5rem; }
        
        @keyframes swing {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        .firecrackers {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .spark {
            position: absolute;
            width: 3px;
            height: 3px;
            background: var(--gold);
            border-radius: 50%;
            animation: sparkle 2s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(0); }
        }
        
        .container {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 80px 20px 50px;
            position: relative;
        }
        
        .header-decoration {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 600px;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }
        
        .header-decoration::before,
        .header-decoration::after {
            content: 'âœ¦';
            position: absolute;
            top: -10px;
            font-size: 1.2rem;
            color: var(--gold);
        }
        
        .header-decoration::before { left: 0; }
        .header-decoration::after { right: 0; }
        
        .main-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: clamp(3.5rem, 10vw, 7rem);
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 50%, var(--gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.5));
            letter-spacing: 0.15em;
            position: relative;
            display: inline-block;
            animation: titleGlow 3s ease-in-out infinite;
        }
        
        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 50px rgba(255, 215, 0, 0.8)); }
        }
        
        .horse-icon {
            font-size: 1.5em;
            margin: 0 0.2em;
            display: inline-block;
            animation: horseGallop 1s ease-in-out infinite;
        }
        
        @keyframes horseGallop {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: var(--light-gold);
            margin-top: 20px;
            letter-spacing: 0.5em;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .year-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--china-red), var(--deep-red));
            color: var(--gold);
            padding: 12px 40px;
            border-radius: 50px;
            margin-top: 25px;
            font-size: 1.1rem;
            letter-spacing: 0.3em;
            box-shadow: 
                0 5px 20px rgba(196, 30, 58, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 2px solid var(--gold);
            position: relative;
            overflow: hidden;
        }
        
        .year-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: badgeShine 3s linear infinite;
        }
        
        @keyframes badgeShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        section {
            margin: 50px 0;
            padding: 40px;
            background: linear-gradient(145deg, rgba(45, 21, 21, 0.95), rgba(26, 10, 10, 0.98));
            border-radius: 25px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }
        
        .section-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2.5rem;
            color: var(--gold);
            text-align: center;
            margin-bottom: 35px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .section-title::before,
        .section-title::after {
            content: 'â—†';
            font-size: 0.6em;
            color: var(--china-red);
        }
        
        .lottery-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .lottery-wheel {
            position: relative;
            width: var(--wheel-size);
            height: var(--wheel-size);
        }
        
        .wheel-outer {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                var(--china-red) 0deg 40deg,
                var(--deep-red) 40deg 80deg,
                var(--china-red) 80deg 120deg,
                var(--deep-red) 120deg 160deg,
                var(--china-red) 160deg 200deg,
                var(--deep-red) 200deg 240deg,
                var(--china-red) 240deg 280deg,
                var(--deep-red) 280deg 320deg,
                var(--china-red) 320deg 360deg
            );
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.3),
                inset 0 0 50px rgba(0, 0, 0, 0.5);
            border: 4px solid var(--gold);
            transition: transform var(--animation-duration) cubic-bezier(0.17, 0.67, 0.12, 0.99);
            will-change: transform;
            overflow: hidden;
        }
        
        .wheel-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            top: 0;
            left: 0;
        }
        
        .wheel-label {
            position: absolute;
            font-size: 0.85rem;
            color: var(--cream);
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            white-space: nowrap;
            transform-origin: center center;
        }
        
        .wheel-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: var(--wheel-inner-size);
            height: var(--wheel-inner-size);
            background: radial-gradient(circle, var(--gold), var(--dark-gold));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }
        
        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--gold);
            filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.5));
            z-index: 3;
        }
        
        .lottery-btn {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: var(--deep-red);
            border: none;
            padding: 18px 60px;
            font-size: 1.4rem;
            font-family: 'Ma Shan Zheng', cursive;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.15em;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .lottery-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
        }
        
        .lottery-btn:focus {
            outline: 3px solid var(--light-gold);
            outline-offset: 3px;
        }
        
        .lottery-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .lottery-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg) translateX(-100%);
            transition: transform 0.6s;
        }
        
        .lottery-btn:hover::after {
            transform: rotate(45deg) translateX(100%);
        }
        
        .lottery-result {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(196, 30, 58, 0.1));
            border-radius: 20px;
            border: 2px solid var(--gold);
            display: none;
            min-width: 300px;
        }
        
        .lottery-result.show {
            display: block;
            animation: resultPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes resultPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .result-title {
            font-size: 1.3rem;
            color: var(--light-gold);
            margin-bottom: 15px;
        }
        
        .result-prize {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2.5rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .result-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .blessings-scroll-container {
            background: linear-gradient(135deg, rgba(196, 30, 58, 0.2), rgba(139, 0, 0, 0.3));
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .blessings-scroll {
            display: flex;
            gap: 50px;
            animation: scrollBlessings 25s linear infinite;
        }
        
        @keyframes scrollBlessings {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .blessing-item {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.8rem;
            color: var(--gold);
            white-space: nowrap;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }
        
        .blessing-separator {
            color: var(--china-red);
            font-size: 1.5rem;
        }
        
        .blessing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .blessing-card {
            background: linear-gradient(145deg, rgba(196, 30, 58, 0.3), rgba(45, 21, 21, 0.8));
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .blessing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .blessing-card:hover,
        .blessing-card:focus {
            transform: translateY(-8px);
            border-color: var(--gold);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.2);
            outline: none;
        }
        
        .blessing-card:hover::before,
        .blessing-card:focus::before {
            opacity: 1;
        }
        
        .blessing-card-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }
        
        .blessing-card-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 10px;
        }
        
        .blessing-card-text {
            font-size: 0.95rem;
            color: var(--light-gold);
            line-height: 1.7;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .blessing-card:hover .blessing-card-text,
        .blessing-card:focus .blessing-card-text {
            opacity: 1;
            max-height: 100px;
            margin-top: 10px;
        }
        
        .card-styles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card-style {
            aspect-ratio: 4/3;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .card-style::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.9;
            z-index: 0;
        }
        
        .card-style.classic::before {
            background: linear-gradient(135deg, var(--china-red), var(--deep-red));
        }
        
        .card-style.elegant::before {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
        }
        
        .card-style.festive::before {
            background: linear-gradient(135deg, var(--bright-red), var(--gold));
        }
        
        .card-style.selected {
            border-color: var(--gold);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            transform: scale(1.02);
        }
        
        .card-style:hover:not(.selected),
        .card-style:focus:not(.selected) {
            transform: scale(1.02);
            border-color: rgba(255, 215, 0, 0.5);
            outline: none;
        }
        
        .card-style-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }
        
        .card-style-name {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 1.3rem;
            position: relative;
            z-index: 1;
        }
        
        .card-style.classic .card-style-name { color: var(--cream); }
        .card-style.elegant .card-style-name { color: var(--deep-red); }
        .card-style.festive .card-style-name { color: var(--dark-bg); }
        
        .card-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 10px;
            color: var(--gold);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            color: var(--cream);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, var(--china-red), var(--deep-red));
            color: var(--gold);
            border: 2px solid var(--gold);
            padding: 18px 50px;
            font-size: 1.3rem;
            font-family: 'Ma Shan Zheng', cursive;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.1em;
            display: block;
            margin: 0 auto;
        }
        
        .generate-btn:hover,
        .generate-btn:focus {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(196, 30, 58, 0.4);
            outline: none;
        }
        
        .card-preview-container {
            margin-top: 40px;
            text-align: center;
            display: none;
        }
        
        .card-preview-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-preview-container canvas {
            max-width: 100%;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 3px solid var(--gold);
        }
        
        .download-btn {
            background: linear-gradient(135deg, var(--gold), var(--dark-gold));
            color: var(--deep-red);
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-family: 'Ma Shan Zheng', cursive;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 25px;
            letter-spacing: 0.1em;
        }
        
        .download-btn:hover,
        .download-btn:focus {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
            outline: none;
        }
        
        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }
        
        .music-btn {
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(145deg, var(--china-red), var(--deep-red));
            border: 3px solid var(--gold);
            color: var(--gold);
            font-size: 1.6rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .music-btn:hover,
        .music-btn:focus {
            transform: scale(1.1);
            outline: none;
        }
        
        .music-btn.playing {
            animation: musicPulse 1.5s infinite;
        }
        
        @keyframes musicPulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(196, 30, 58, 0.4); }
            50% { box-shadow: 0 8px 40px rgba(255, 215, 0, 0.6); }
        }
        
        .music-visualizer {
            position: absolute;
            bottom: 75px;
            right: 5px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .music-btn.playing + .music-visualizer {
            opacity: 1;
        }
        
        .music-bar {
            width: 5px;
            height: 25px;
            background: var(--gold);
            border-radius: 3px;
            animation: musicBar 0.6s ease-in-out infinite alternate;
        }
        
        .music-bar:nth-child(1) { animation-delay: 0s; }
        .music-bar:nth-child(2) { animation-delay: 0.1s; }
        .music-bar:nth-child(3) { animation-delay: 0.2s; }
        .music-bar:nth-child(4) { animation-delay: 0.15s; }
        
        @keyframes musicBar {
            0% { height: 12px; }
            100% { height: 30px; }
        }
        
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }
        
        .firework {
            position: absolute;
            border-radius: 50%;
            animation: fireworkBurst 1.5s ease-out forwards;
        }
        
        @keyframes fireworkBurst {
            0% { transform: scale(0); opacity: 1; }
            50% { opacity: 0.8; }
            100% { transform: scale(30); opacity: 0; }
        }
        
        footer {
            text-align: center;
            padding: 50px 20px;
            position: relative;
        }
        
        .footer-decoration {
            width: 60%;
            max-width: 400px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            margin: 0 auto 20px;
        }
        
        footer p {
            color: var(--light-gold);
            margin: 8px 0;
            font-size: 1rem;
        }
        
        .footer-icon {
            font-size: 1.5rem;
            margin: 0 10px;
        }
        
        @media (max-width: 768px) {
            .lantern {
                font-size: 2rem;
            }
            
            .music-control {
                bottom: 20px;
                right: 20px;
            }
            
            .music-btn {
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }
            
            section {
                padding: 25px;
                margin: 30px 0;
            }
            
            .blessing-cards {
                grid-template-columns: 1fr;
            }
            
            .card-styles {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .blessings-scroll {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen" role="status" aria-label="é¡µé¢åŠ è½½ä¸­">
        <div class="loading-horse">ğŸ´</div>
        <p class="loading-text">æ–°æ˜¥ç››å…¸åŠ è½½ä¸­</p>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingBar"></div>
        </div>
    </div>
    
    <div class="bg-layer bg-gradient" aria-hidden="true"></div>
    
    <div class="lanterns" aria-hidden="true">
        <span class="lantern">ğŸ®</span>
        <span class="lantern">ğŸ®</span>
        <span class="lantern">ğŸ®</span>
        <span class="lantern">ğŸ®</span>
    </div>
    
    <div class="firecrackers" id="firecrackers" aria-hidden="true"></div>
    <div class="fireworks-container" id="fireworks" aria-hidden="true"></div>
    
    <main class="container">
        <header>
            <div class="header-decoration" aria-hidden="true"></div>
            <h1 class="main-title">
                <span class="horse-icon" aria-hidden="true">ğŸ´</span>
                ç”²åˆé©¬å¹´
                <span class="horse-icon" aria-hidden="true">ğŸ´</span>
            </h1>
            <p class="subtitle">é¾™é©¬ç²¾ç¥ Â· ä¸‡äº‹å¦‚æ„</p>
            <span class="year-badge">âœ¦ æ–°æ˜¥ç››å…¸ âœ¦</span>
        </header>
        
        <section id="lottery" aria-labelledby="lottery-title">
            <h2 class="section-title" id="lottery-title">æ–°æ˜¥æŠ½å¥–</h2>
            <div class="lottery-container">
                <div class="lottery-wheel" role="img" aria-label="æŠ½å¥–è½¬ç›˜">
                    <div class="wheel-pointer" aria-hidden="true"></div>
                    <div class="wheel-outer" id="wheelOuter" aria-hidden="true">
                        <div class="wheel-labels" id="wheelLabels"></div>
                    </div>
                    <div class="wheel-inner" aria-hidden="true">ğŸ</div>
                </div>
                <button class="lottery-btn" id="lotteryBtn" aria-describedby="lottery-instruction">
                    å¼€å§‹æŠ½å¥–
                </button>
                <span id="lottery-instruction" class="visually-hidden">ç‚¹å‡»æŒ‰é’®å¼€å§‹æŠ½å¥–è½¬ç›˜</span>
                <div class="lottery-result" id="lotteryResult" role="alert" aria-live="polite">
                    <div class="result-icon" id="resultIcon" aria-hidden="true">ğŸ‰</div>
                    <p class="result-title">æ­å–œæ‚¨è·å¾—</p>
                    <p class="result-prize" id="prizeText"></p>
                </div>
            </div>
        </section>
        
        <section id="blessings" aria-labelledby="blessings-title">
            <h2 class="section-title" id="blessings-title">æ–°æ˜¥ç¥ç¦</h2>
            <div class="blessings-scroll-container" aria-label="æ»šåŠ¨ç¥ç¦è¯­">
                <div class="blessings-scroll" id="blessingsScroll">
                    <span class="blessing-item">é©¬åˆ°æˆåŠŸ</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é¾™é©¬ç²¾ç¥</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸€é©¬å½“å…ˆ</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸‡é©¬å¥”è…¾</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é©¬å¹´å¤§å‰</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">å‰ç¥¥å¦‚æ„</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é˜–å®¶å¹¸ç¦</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸‡äº‹äº¨é€š</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é©¬åˆ°æˆåŠŸ</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é¾™é©¬ç²¾ç¥</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸€é©¬å½“å…ˆ</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸‡é©¬å¥”è…¾</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é©¬å¹´å¤§å‰</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">å‰ç¥¥å¦‚æ„</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">é˜–å®¶å¹¸ç¦</span>
                    <span class="blessing-separator">âœ¦</span>
                    <span class="blessing-item">ä¸‡äº‹äº¨é€š</span>
                    <span class="blessing-separator">âœ¦</span>
                </div>
            </div>
            <div class="blessing-cards" role="list">
                <div class="blessing-card" role="listitem" tabindex="0" aria-label="é©¬åˆ°æˆåŠŸç¥ç¦">
                    <span class="blessing-card-icon" aria-hidden="true">ğŸ´</span>
                    <h3 class="blessing-card-title">é©¬åˆ°æˆåŠŸ</h3>
                    <p class="blessing-card-text">æ„¿æ‚¨é©¬å¹´ï¼šäº‹ä¸šå¦‚éªé©¬å¥”è…¾ï¼Œè´¢æºä¼¼ä¸‡é©¬é½å–‘ï¼Œç”Ÿæ´»è‹¥æ˜¥é£å¾—æ„ï¼</p>
                </div>
                <div class="blessing-card" role="listitem" tabindex="0" aria-label="é¾™é©¬ç²¾ç¥ç¥ç¦">
                    <span class="blessing-card-icon" aria-hidden="true">ğŸ‰</span>
                    <h3 class="blessing-card-title">é¾™é©¬ç²¾ç¥</h3>
                    <p class="blessing-card-text">ç¥æ‚¨æ–°å¹´ï¼šé¾™é©¬ç²¾ç¥å±•å®å›¾ï¼Œé‡‘æˆˆé“é©¬åˆ›ä¼Ÿä¸šï¼Œå¤©é©¬è¡Œç©ºä»»ç¿±ç¿”ï¼</p>
                </div>
                <div class="blessing-card" role="listitem" tabindex="0" aria-label="ä¸€é©¬å½“å…ˆç¥ç¦">
                    <span class="blessing-card-icon" aria-hidden="true">â­</span>
                    <h3 class="blessing-card-title">ä¸€é©¬å½“å…ˆ</h3>
                    <p class="blessing-card-text">æ„¿æ–°çš„ä¸€å¹´ï¼šä¸€é©¬å½“å…ˆå¼€æ–°å±€ï¼Œå¿«é©¬åŠ é­å¥”å‰ç¨‹ï¼Œæ±—é©¬åŠŸåŠ³é“¸è¾‰ç…Œï¼</p>
                </div>
                <div class="blessing-card" role="listitem" tabindex="0" aria-label="å‰ç¥¥å¦‚æ„ç¥ç¦">
                    <span class="blessing-card-icon" aria-hidden="true">ğŸ®</span>
                    <h3 class="blessing-card-title">å‰ç¥¥å¦‚æ„</h3>
                    <p class="blessing-card-text">æ­ç¥æ‚¨ï¼šé©¬å¹´è¡Œå¤§è¿ï¼Œç¦ç¦„åŒå…¨è‡³ï¼Œé˜–å®¶çš†æ¬¢ä¹ï¼Œä¸‡äº‹å°½å¦‚æ„ï¼</p>
                </div>
            </div>
        </section>
        
        <section id="greetingCard" aria-labelledby="card-title">
            <h2 class="section-title" id="card-title">è´ºå¡ç”Ÿæˆ</h2>
            <div class="card-styles" role="radiogroup" aria-label="é€‰æ‹©è´ºå¡é£æ ¼">
                <div class="card-style classic selected" data-style="classic" role="radio" aria-checked="true" tabindex="0">
                    <span class="card-style-icon" aria-hidden="true">ğŸ´</span>
                    <span class="card-style-name">ç»å…¸çº¢é‡‘</span>
                </div>
                <div class="card-style elegant" data-style="elegant" role="radio" aria-checked="false" tabindex="0">
                    <span class="card-style-icon" aria-hidden="true">ğŸŠ</span>
                    <span class="card-style-name">åè´µé‡‘éŸµ</span>
                </div>
                <div class="card-style festive" data-style="festive" role="radio" aria-checked="false" tabindex="0">
                    <span class="card-style-icon" aria-hidden="true">ğŸ®</span>
                    <span class="card-style-name">å–œåº†çº¢é‡‘</span>
                </div>
            </div>
            <form class="card-form" id="cardForm" aria-label="è´ºå¡ä¿¡æ¯è¡¨å•">
                <div class="form-group">
                    <label for="recipientName">æ”¶ä»¶äººå§“å</label>
                    <input type="text" id="recipientName" placeholder="è¯·è¾“å…¥æ”¶ä»¶äººå§“å" maxlength="20" autocomplete="name">
                </div>
                <div class="form-group">
                    <label for="senderName">å‘ä»¶äººå§“å</label>
                    <input type="text" id="senderName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" maxlength="20" autocomplete="name">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="blessingText">ç¥ç¦è¯­</label>
                    <textarea id="blessingText" placeholder="è¯·è¾“å…¥æ‚¨çš„ç¥ç¦è¯­..." maxlength="100">é©¬å¹´åˆ°ï¼Œå¥½è¿åˆ°ï¼æ„¿æ‚¨æ–°çš„ä¸€å¹´ï¼šé¾™é©¬ç²¾ç¥ï¼Œé©¬åˆ°æˆåŠŸï¼</textarea>
                </div>
            </form>
            <button class="generate-btn" id="generateBtn" type="button">ç”Ÿæˆè´ºå¡</button>
            <div class="card-preview-container" id="cardPreview" aria-label="è´ºå¡é¢„è§ˆ">
                <canvas id="greetingCanvas" width="600" height="450" aria-label="ç”Ÿæˆçš„è´ºå¡å›¾ç‰‡"></canvas>
                <br>
                <button class="download-btn" id="downloadBtn" type="button">ä¸‹è½½è´ºå¡</button>
            </div>
        </section>
        
        <footer>
            <div class="footer-decoration" aria-hidden="true"></div>
            <p>
                <span class="footer-icon" aria-hidden="true">ğŸ´</span>
                ç”²åˆé©¬å¹´ Â· æ–°æ˜¥ç››å…¸
                <span class="footer-icon" aria-hidden="true">ğŸ´</span>
            </p>
            <p>ç¥æ‚¨é©¬å¹´å¤§å‰ï¼Œä¸‡äº‹å¦‚æ„</p>
        </footer>
    </main>
    
    <div class="music-control">
        <button class="music-btn" id="musicBtn" aria-label="æ’­æ”¾èƒŒæ™¯éŸ³ä¹" aria-pressed="false">ğŸµ</button>
        <div class="music-visualizer" aria-hidden="true">
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
            <div class="music-bar"></div>
        </div>
    </div>
    
    <audio id="bgMusic" loop preload="auto">
        <source src="https://www.kkkkmmmm.com/wj/224444/2024/11/08/962d97230e74e71f73f4057bec37c220.mp3?c=99" type="audio/mpeg">
        <source src="https://cdn.pixabay.com/audio/2022/08/02/audio_884fe92c21.mp3" type="audio/mpeg">
    </audio>
    
    <style>
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
    
    <script>
    (function() {
        'use strict';
        
        const CONFIG = {
            prizes: [
                { name: 'ä¸€ç­‰å¥–', icon: 'ğŸ†' },
                { name: 'äºŒç­‰å¥–', icon: 'ğŸ¥ˆ' },
                { name: 'ä¸‰ç­‰å¥–', icon: 'ğŸ¥‰' },
                { name: 'å¹¸è¿å¥–', icon: 'ğŸ€' },
                { name: 'é©¬å¹´å¤§å‰', icon: 'ğŸ´' },
                { name: 'æ–°å¹´å¿«ä¹', icon: 'ğŸŠ' },
                { name: 'æ­å–œå‘è´¢', icon: 'ğŸ’°' },
                { name: 'å¿ƒæƒ³äº‹æˆ', icon: 'âœ¨' },
                { name: 'ä¸‡äº‹å¦‚æ„', icon: 'ğŸ' }
            ],
            fireworkColors: ['#c41e3a', '#ffd700', '#e74c3c', '#fff4d6', '#ff6b6b'],
            cardStyles: {
                classic: {
                    bg: ['#c41e3a', '#8b0000'],
                    accent: '#ffd700',
                    text: '#fffef5',
                    icon: 'ğŸ´'
                },
                elegant: {
                    bg: ['#ffd700', '#b8860b'],
                    accent: '#8b0000',
                    text: '#1a0a0a',
                    icon: 'ğŸŠ'
                },
                festive: {
                    bg: ['#e74c3c', '#ffd700'],
                    accent: '#1a0a0a',
                    text: '#1a0a0a',
                    icon: 'ğŸ®'
                }
            },
            storageKeys: {
                cardStyle: 'horseYear_cardStyle',
                recipientName: 'horseYear_recipientName',
                senderName: 'horseYear_senderName'
            }
        };
        
        const DOM = {
            loadingScreen: document.getElementById('loadingScreen'),
            loadingBar: document.getElementById('loadingBar'),
            wheelOuter: document.getElementById('wheelOuter'),
            wheelLabels: document.getElementById('wheelLabels'),
            lotteryBtn: document.getElementById('lotteryBtn'),
            lotteryResult: document.getElementById('lotteryResult'),
            prizeText: document.getElementById('prizeText'),
            resultIcon: document.getElementById('resultIcon'),
            firecrackers: document.getElementById('firecrackers'),
            fireworks: document.getElementById('fireworks'),
            cardStyles: document.querySelectorAll('.card-style'),
            recipientName: document.getElementById('recipientName'),
            senderName: document.getElementById('senderName'),
            blessingText: document.getElementById('blessingText'),
            generateBtn: document.getElementById('generateBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            cardPreview: document.getElementById('cardPreview'),
            greetingCanvas: document.getElementById('greetingCanvas'),
            musicBtn: document.getElementById('musicBtn'),
            bgMusic: document.getElementById('bgMusic')
        };
        
        let state = {
            isSpinning: false,
            currentRotation: 0,
            selectedStyle: 'classic',
            isPlaying: false,
            sparkPool: [],
            fireworkPool: [],
            intervals: [],
            timeouts: []
        };
        
        function safeLocalStorage(action, key, value) {
            try {
                if (action === 'get') {
                    return localStorage.getItem(key);
                } else if (action === 'set') {
                    localStorage.setItem(key, value);
                    return true;
                }
            } catch (e) {
                console.warn('localStorage ä¸å¯ç”¨:', e.message);
                return null;
            }
        }
        
        function managedSetInterval(callback, delay) {
            const id = setInterval(callback, delay);
            state.intervals.push(id);
            return id;
        }
        
        function managedSetTimeout(callback, delay) {
            const id = setTimeout(() => {
                const index = state.timeouts.indexOf(id);
                if (index > -1) state.timeouts.splice(index, 1);
                callback();
            }, delay);
            state.timeouts.push(id);
            return id;
        }
        
        function cleanup() {
            state.intervals.forEach(id => clearInterval(id));
            state.timeouts.forEach(id => clearTimeout(id));
            state.intervals = [];
            state.timeouts = [];
        }
        
        function init() {
            simulateLoading();
            createWheelLabels();
            loadSavedData();
            bindEvents();
            startSparks();
            startRandomFireworks();
            
            window.addEventListener('beforeunload', cleanup);
            
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    createWheelLabels();
                }, 100);
            });
        }
        
        function simulateLoading() {
            let progress = 0;
            let loadingIntervalId = null;
            
            loadingIntervalId = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingIntervalId);
                    managedSetTimeout(() => {
                        DOM.loadingScreen.classList.add('hidden');
                    }, 300);
                }
                DOM.loadingBar.style.width = progress + '%';
            }, 100);
        }
        
        function createWheelLabels() {
            DOM.wheelLabels.innerHTML = '';
            
            const wheelOuter = DOM.wheelOuter;
            const wheelSize = wheelOuter.offsetWidth || 350;
            const radiusPercent = 72;
            const angleStep = 360 / CONFIG.prizes.length;
            
            CONFIG.prizes.forEach((prize, index) => {
                const angle = index * angleStep + angleStep / 2 - 90;
                const radian = angle * Math.PI / 180;
                const xPercent = 50 + radiusPercent * Math.cos(radian) * 0.5;
                const yPercent = 50 + radiusPercent * Math.sin(radian) * 0.5;
                
                const label = document.createElement('div');
                label.className = 'wheel-label';
                label.textContent = prize.name;
                label.style.left = xPercent + '%';
                label.style.top = yPercent + '%';
                label.style.transform = `translate(-50%, -50%) rotate(${angle + 90}deg)`;
                DOM.wheelLabels.appendChild(label);
            });
        }
        
        function loadSavedData() {
            const savedStyle = safeLocalStorage('get', CONFIG.storageKeys.cardStyle);
            if (savedStyle && CONFIG.cardStyles[savedStyle]) {
                state.selectedStyle = savedStyle;
                DOM.cardStyles.forEach(s => {
                    const isSelected = s.dataset.style === savedStyle;
                    s.classList.toggle('selected', isSelected);
                    s.setAttribute('aria-checked', isSelected);
                });
            }
            
            const savedRecipient = safeLocalStorage('get', CONFIG.storageKeys.recipientName);
            if (savedRecipient) DOM.recipientName.value = savedRecipient;
            
            const savedSender = safeLocalStorage('get', CONFIG.storageKeys.senderName);
            if (savedSender) DOM.senderName.value = savedSender;
        }
        
        function bindEvents() {
            DOM.lotteryBtn.addEventListener('click', spinWheel);
            
            DOM.cardStyles.forEach(style => {
                style.addEventListener('click', () => selectCardStyle(style));
                style.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectCardStyle(style);
                    }
                });
            });
            
            DOM.generateBtn.addEventListener('click', generateCard);
            DOM.downloadBtn.addEventListener('click', downloadCard);
            DOM.musicBtn.addEventListener('click', toggleMusic);
            
            DOM.recipientName.addEventListener('input', () => {
                safeLocalStorage('set', CONFIG.storageKeys.recipientName, DOM.recipientName.value);
            });
            
            DOM.senderName.addEventListener('input', () => {
                safeLocalStorage('set', CONFIG.storageKeys.senderName, DOM.senderName.value);
            });
        }
        
        function selectCardStyle(style) {
            DOM.cardStyles.forEach(s => {
                s.classList.remove('selected');
                s.setAttribute('aria-checked', 'false');
            });
            style.classList.add('selected');
            style.setAttribute('aria-checked', 'true');
            state.selectedStyle = style.dataset.style;
            safeLocalStorage('set', CONFIG.storageKeys.cardStyle, state.selectedStyle);
        }
        
        function spinWheel() {
            if (state.isSpinning) return;
            
            state.isSpinning = true;
            DOM.lotteryBtn.disabled = true;
            DOM.lotteryResult.classList.remove('show');
            
            const prizeIndex = Math.floor(Math.random() * CONFIG.prizes.length);
            const anglePerPrize = 360 / CONFIG.prizes.length;
            const targetAngle = 360 - (prizeIndex * anglePerPrize + anglePerPrize / 2);
            const spins = 5 + Math.floor(Math.random() * 3);
            const totalRotation = spins * 360 + targetAngle;
            
            state.currentRotation += totalRotation;
            DOM.wheelOuter.style.transform = `rotate(${state.currentRotation}deg)`;
            
            managedSetTimeout(() => {
                showResult(CONFIG.prizes[prizeIndex]);
                state.isSpinning = false;
                DOM.lotteryBtn.disabled = false;
            }, 4000);
        }
        
        function showResult(prize) {
            DOM.resultIcon.textContent = prize.icon;
            DOM.prizeText.textContent = prize.name;
            DOM.lotteryResult.classList.add('show');
            createFireworks();
        }
        
        function createFireworks() {
            const container = DOM.fireworks;
            
            for (let i = 0; i < 30; i++) {
                managedSetTimeout(() => {
                    let firework = state.fireworkPool.pop();
                    
                    if (!firework) {
                        firework = document.createElement('div');
                        firework.className = 'firework';
                    }
                    
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    const size = Math.random() * 10 + 5;
                    firework.style.width = size + 'px';
                    firework.style.height = size + 'px';
                    const color = CONFIG.fireworkColors[Math.floor(Math.random() * CONFIG.fireworkColors.length)];
                    firework.style.background = color;
                    firework.style.boxShadow = `0 0 20px ${color}`;
                    
                    container.appendChild(firework);
                    
                    managedSetTimeout(() => {
                        if (firework.parentNode) {
                            firework.remove();
                        }
                        state.fireworkPool.push(firework);
                    }, 1500);
                }, i * 50);
            }
        }
        
        function startSparks() {
            const container = DOM.firecrackers;
            
            managedSetInterval(() => {
                let spark = state.sparkPool.pop();
                
                if (!spark) {
                    spark = document.createElement('div');
                    spark.className = 'spark';
                }
                
                spark.style.left = Math.random() * 100 + '%';
                spark.style.top = Math.random() * 100 + '%';
                spark.style.animation = 'none';
                spark.offsetHeight;
                spark.style.animation = 'sparkle 2s ease-out forwards';
                
                container.appendChild(spark);
                
                managedSetTimeout(() => {
                    if (spark.parentNode) {
                        spark.remove();
                    }
                    state.sparkPool.push(spark);
                }, 2000);
            }, 300);
        }
        
        function startRandomFireworks() {
            managedSetInterval(() => {
                if (Math.random() > 0.85) {
                    createFireworks();
                }
            }, 8000);
        }
        
        function generateCard() {
            const recipientName = DOM.recipientName.value || 'æœ‹å‹';
            const senderName = DOM.senderName.value || 'åŒ¿å';
            const blessingText = DOM.blessingText.value || 'é©¬å¹´å¤§å‰ï¼';
            
            const canvas = DOM.greetingCanvas;
            const ctx = canvas.getContext('2d');
            const style = CONFIG.cardStyles[state.selectedStyle];
            
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, style.bg[0]);
            gradient.addColorStop(1, style.bg[1]);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = style.accent;
            ctx.lineWidth = 8;
            ctx.strokeRect(15, 15, canvas.width - 30, canvas.height - 30);
            
            ctx.strokeStyle = style.accent;
            ctx.lineWidth = 2;
            ctx.strokeRect(25, 25, canvas.width - 50, canvas.height - 50);
            
            for (let i = 0; i < 4; i++) {
                ctx.beginPath();
                ctx.arc(40 + i * 180, 40, 8, 0, Math.PI * 2);
                ctx.fillStyle = style.accent;
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(40 + i * 180, canvas.height - 40, 8, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.font = '70px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(style.icon, canvas.width / 2, 100);
            
            ctx.font = 'bold 42px "Noto Serif SC", serif';
            ctx.fillStyle = style.text;
            ctx.textAlign = 'center';
            ctx.fillText('ç”²åˆé©¬å¹´', canvas.width / 2, 170);
            
            ctx.font = '24px "Noto Serif SC", serif';
            ctx.fillStyle = style.accent;
            ctx.fillText('è‡´ï¼š' + recipientName, canvas.width / 2, 230);
            
            ctx.font = '20px "Noto Serif SC", serif';
            ctx.fillStyle = style.text;
            
            const maxWidth = canvas.width - 120;
            const lines = wrapText(ctx, blessingText, maxWidth);
            let y = 290;
            lines.forEach(line => {
                ctx.fillText(line, canvas.width / 2, y);
                y += 32;
            });
            
            ctx.font = '18px "Noto Serif SC", serif';
            ctx.fillStyle = style.accent;
            ctx.textAlign = 'right';
            ctx.fillText('â€”â€” ' + senderName, canvas.width - 50, canvas.height - 45);
            
            DOM.cardPreview.classList.add('show');
        }
        
        function wrapText(ctx, text, maxWidth) {
            const lines = [];
            let currentLine = '';
            
            for (let i = 0; i < text.length; i++) {
                const testLine = currentLine + text[i];
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && currentLine !== '') {
                    lines.push(currentLine);
                    currentLine = text[i];
                } else {
                    currentLine = testLine;
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }
        
        function downloadCard() {
            const canvas = DOM.greetingCanvas;
            const link = document.createElement('a');
            link.download = 'é©¬å¹´è´ºå¡.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        function toggleMusic() {
            if (state.isPlaying) {
                DOM.bgMusic.pause();
                DOM.musicBtn.classList.remove('playing');
                DOM.musicBtn.textContent = 'ğŸµ';
                DOM.musicBtn.setAttribute('aria-pressed', 'false');
                DOM.musicBtn.setAttribute('aria-label', 'æ’­æ”¾èƒŒæ™¯éŸ³ä¹');
            } else {
                DOM.bgMusic.play().catch(e => {
                    console.log('éŸ³é¢‘æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’');
                });
                DOM.musicBtn.classList.add('playing');
                DOM.musicBtn.textContent = 'ğŸ”Š';
                DOM.musicBtn.setAttribute('aria-pressed', 'true');
                DOM.musicBtn.setAttribute('aria-label', 'æš‚åœèƒŒæ™¯éŸ³ä¹');
            }
            state.isPlaying = !state.isPlaying;
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    })();
    </script>
</body>
</html>